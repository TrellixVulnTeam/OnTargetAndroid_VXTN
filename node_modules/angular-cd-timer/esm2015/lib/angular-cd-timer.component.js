/**
 * @fileoverview added by tsickle
 * Generated from: lib/angular-cd-timer.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, Input, Output, Renderer2 } from '@angular/core';
export class CdTimerComponent {
    /**
     * @param {?} elt
     * @param {?} renderer
     */
    constructor(elt, renderer) {
        this.elt = elt;
        this.renderer = renderer;
        this.onStart = new EventEmitter();
        this.onStop = new EventEmitter();
        this.onTick = new EventEmitter();
        this.onComplete = new EventEmitter();
        // Initialization
        this.autoStart = true;
        this.startTime = 0;
        this.endTime = 0;
        this.timeoutId = null;
        this.countdown = false;
        this.format = 'default';
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        /** @type {?} */
        const ngContentNode = this.elt.nativeElement.lastChild;
        this.ngContentSchema = ngContentNode ? ngContentNode.nodeValue : '';
        if (this.autoStart === undefined || this.autoStart === true) {
            this.start();
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.resetTimeout();
    }
    /**
     * Start the timer
     * @return {?}
     */
    start() {
        this.initVar();
        this.resetTimeout();
        this.computeTimeUnits();
        this.startTickCount();
        this.onStart.emit(this);
    }
    /**
     * Resume the timer
     * @return {?}
     */
    resume() {
        this.resetTimeout();
        this.startTickCount();
    }
    /**
     * Stop the timer
     * @return {?}
     */
    stop() {
        this.clear();
        this.onStop.emit(this);
    }
    /**
     * Reset the timer
     * @return {?}
     */
    reset() {
        this.initVar();
        this.resetTimeout();
        this.clear();
        this.computeTimeUnits();
        this.renderText();
    }
    /**
     * Get the time information
     * @return {?} TimeInterface
     */
    get() {
        return {
            seconds: this.seconds,
            minutes: this.minutes,
            hours: this.hours,
            days: this.days,
            timer: this.timeoutId,
            tick_count: this.tickCounter
        };
    }
    /**
     * Initialize variable before start
     * @private
     * @return {?}
     */
    initVar() {
        this.startTime = this.startTime || 0;
        this.endTime = this.endTime || 0;
        this.countdown = this.countdown || false;
        this.tickCounter = this.startTime;
        // Disable countdown if start time not defined
        if (this.countdown && this.startTime === 0) {
            this.countdown = false;
        }
        // Determine auto format
        if (!this.format) {
            this.format = (this.ngContentSchema.length > 5) ? 'user' : 'default';
        }
    }
    /**
     * Reset timeout
     * @private
     * @return {?}
     */
    resetTimeout() {
        if (this.timeoutId) {
            clearInterval(this.timeoutId);
        }
    }
    /**
     * Render the time to DOM
     * @private
     * @return {?}
     */
    renderText() {
        /** @type {?} */
        let outputText;
        if (this.format === 'user') {
            // User presentation
            /** @type {?} */
            const items = {
                'seconds': this.seconds,
                'minutes': this.minutes,
                'hours': this.hours,
                'days': this.days
            };
            outputText = this.ngContentSchema;
            for (const key of Object.keys(items)) {
                outputText = outputText.replace('[' + key + ']', ((/** @type {?} */ (items)))[key].toString());
            }
        }
        else if (this.format === 'intelli') {
            // Intelli presentation
            outputText = '';
            if (this.days > 0) {
                outputText += this.days.toString() + 'day' + ((this.days > 1) ? 's' : '') + ' ';
            }
            if ((this.hours > 0) || (this.days > 0)) {
                outputText += this.hours.toString() + 'h ';
            }
            if (((this.minutes > 0) || (this.hours > 0)) && (this.days === 0)) {
                outputText += this.minutes.toString().padStart(2, '0') + 'min ';
            }
            if ((this.hours === 0) && (this.days === 0)) {
                outputText += this.seconds.toString().padStart(2, '0') + 's';
            }
        }
        else if (this.format === 'hms') {
            // Hms presentation
            outputText = this.hours.toString().padStart(2, '0') + ':';
            outputText += this.minutes.toString().padStart(2, '0') + ':';
            outputText += this.seconds.toString().padStart(2, '0');
        }
        else {
            // Default presentation
            outputText = this.days.toString() + 'd ';
            outputText += this.hours.toString() + 'h ';
            outputText += this.minutes.toString() + 'm ';
            outputText += this.seconds.toString() + 's';
        }
        this.renderer.setProperty(this.elt.nativeElement, 'innerHTML', outputText);
    }
    /**
     * @private
     * @return {?}
     */
    clear() {
        this.resetTimeout();
        this.timeoutId = null;
    }
    /**
     * Compute each unit (seconds, minutes, hours, days) for further manipulation
     * @protected
     * @return {?}
     */
    computeTimeUnits() {
        if (!this.maxTimeUnit || this.maxTimeUnit === 'day') {
            this.seconds = Math.floor(this.tickCounter % 60);
            this.minutes = Math.floor((this.tickCounter / 60) % 60);
            this.hours = Math.floor((this.tickCounter / 3600) % 24);
            this.days = Math.floor((this.tickCounter / 3600) / 24);
        }
        else if (this.maxTimeUnit === 'second') {
            this.seconds = this.tickCounter;
            this.minutes = 0;
            this.hours = 0;
            this.days = 0;
        }
        else if (this.maxTimeUnit === 'minute') {
            this.seconds = Math.floor(this.tickCounter % 60);
            this.minutes = Math.floor(this.tickCounter / 60);
            this.hours = 0;
            this.days = 0;
        }
        else if (this.maxTimeUnit === 'hour') {
            this.seconds = Math.floor(this.tickCounter % 60);
            this.minutes = Math.floor((this.tickCounter / 60) % 60);
            this.hours = Math.floor(this.tickCounter / 3600);
            this.days = 0;
        }
        this.renderText();
    }
    /**
     * Start tick count, base of this component
     * @protected
     * @return {?}
     */
    startTickCount() {
        /** @type {?} */
        const that = this;
        that.timeoutId = setInterval((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            let counter;
            if (that.countdown) {
                // Compute finish counter for countdown
                counter = that.tickCounter;
                if (that.startTime > that.endTime) {
                    counter = that.tickCounter - that.endTime - 1;
                }
            }
            else {
                // Compute finish counter for timer
                counter = that.tickCounter - that.startTime;
                if (that.endTime > that.startTime) {
                    counter = that.endTime - that.tickCounter - 1;
                }
            }
            that.computeTimeUnits();
            /** @type {?} */
            const timer = {
                seconds: that.seconds,
                minutes: that.minutes,
                hours: that.hours,
                days: that.days,
                timer: that.timeoutId,
                tick_count: that.tickCounter
            };
            that.onTick.emit(timer);
            if (counter < 0) {
                that.stop();
                that.onComplete.emit(that);
                return;
            }
            if (that.countdown) {
                that.tickCounter--;
            }
            else {
                that.tickCounter++;
            }
        }), 1000); // Each seconds
    }
}
CdTimerComponent.decorators = [
    { type: Component, args: [{
                selector: 'cd-timer',
                template: ' <ng-content></ng-content>'
            }] }
];
/** @nocollapse */
CdTimerComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
CdTimerComponent.propDecorators = {
    startTime: [{ type: Input }],
    endTime: [{ type: Input }],
    countdown: [{ type: Input }],
    autoStart: [{ type: Input }],
    maxTimeUnit: [{ type: Input }],
    format: [{ type: Input }],
    onStart: [{ type: Output }],
    onStop: [{ type: Output }],
    onTick: [{ type: Output }],
    onComplete: [{ type: Output }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.timeoutId;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.tickCounter;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.ngContentSchema;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.seconds;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.minutes;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.hours;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.days;
    /** @type {?} */
    CdTimerComponent.prototype.startTime;
    /** @type {?} */
    CdTimerComponent.prototype.endTime;
    /** @type {?} */
    CdTimerComponent.prototype.countdown;
    /** @type {?} */
    CdTimerComponent.prototype.autoStart;
    /** @type {?} */
    CdTimerComponent.prototype.maxTimeUnit;
    /** @type {?} */
    CdTimerComponent.prototype.format;
    /** @type {?} */
    CdTimerComponent.prototype.onStart;
    /** @type {?} */
    CdTimerComponent.prototype.onStop;
    /** @type {?} */
    CdTimerComponent.prototype.onTick;
    /** @type {?} */
    CdTimerComponent.prototype.onComplete;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.elt;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1jZC10aW1lci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLWNkLXRpbWVyLyIsInNvdXJjZXMiOlsibGliL2FuZ3VsYXItY2QtdGltZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsT0FBTyxFQUVMLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBYSxNQUFNLEVBQUUsU0FBUyxFQUN6RSxNQUFNLGVBQWUsQ0FBQztBQU92QixNQUFNLE9BQU8sZ0JBQWdCOzs7OztJQXFCM0IsWUFBb0IsR0FBZSxFQUFVLFFBQW1CO1FBQTVDLFFBQUcsR0FBSCxHQUFHLENBQVk7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBTHRELFlBQU8sR0FBbUMsSUFBSSxZQUFZLEVBQW9CLENBQUM7UUFDL0UsV0FBTSxHQUFtQyxJQUFJLFlBQVksRUFBb0IsQ0FBQztRQUM5RSxXQUFNLEdBQWdDLElBQUksWUFBWSxFQUFpQixDQUFDO1FBQ3hFLGVBQVUsR0FBbUMsSUFBSSxZQUFZLEVBQW9CLENBQUM7UUFHMUYsaUJBQWlCO1FBQ2pCLElBQUksQ0FBQyxTQUFTLEdBQUksSUFBSSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxTQUFTLEdBQUksQ0FBQyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxPQUFPLEdBQU0sQ0FBQyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxTQUFTLEdBQUksSUFBSSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxTQUFTLEdBQUksS0FBSyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxNQUFNLEdBQU8sU0FBUyxDQUFDO0lBQzlCLENBQUM7Ozs7SUFFRCxlQUFlOztjQUNQLGFBQWEsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxTQUFTO1FBQ3RELElBQUksQ0FBQyxlQUFlLEdBQUcsYUFBYSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFF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QkFDTCxLQUFLO3dCQUNMLEtBQUs7MEJBQ0wsS0FBSztxQkFDTCxLQUFLO3NCQUNMLE1BQU07cUJBQ04sTUFBTTtxQkFDTixNQUFNO3lCQUNOLE1BQU07Ozs7Ozs7SUFsQlAscUNBQXVCOzs7OztJQUN2Qix1Q0FBNEI7Ozs7O0lBQzVCLDJDQUFnQzs7Ozs7SUFFaEMsbUNBQXdCOzs7OztJQUN4QixtQ0FBd0I7Ozs7O0lBQ3hCLGlDQUFzQjs7Ozs7SUFDdEIsZ0NBQXFCOztJQUVyQixxQ0FBMkI7O0lBQzNCLG1DQUF5Qjs7SUFDekIscUNBQTRCOztJQUM1QixxQ0FBNEI7O0lBQzVCLHVDQUE2Qjs7SUFDN0Isa0NBQXdCOztJQUN4QixtQ0FBeUY7O0lBQ3pGLGtDQUF3Rjs7SUFDeEYsa0NBQWtGOztJQUNsRixzQ0FBNEY7Ozs7O0lBRWhGLCtCQUF1Qjs7Ozs7SUFBRSxvQ0FBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25EZXN0cm95LCBPdXRwdXQsIFJlbmRlcmVyMlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7VGltZUludGVyZmFjZX0gZnJvbSAnLi9hbmd1bGFyLWNkLXRpbWVyLmludGVyZmFjZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2NkLXRpbWVyJyxcbiAgdGVtcGxhdGU6ICcgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50Pidcbn0pXG5leHBvcnQgY2xhc3MgQ2RUaW1lckNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgdGltZW91dElkOiBhbnk7XG4gIHByaXZhdGUgdGlja0NvdW50ZXI6IG51bWJlcjtcbiAgcHJpdmF0ZSBuZ0NvbnRlbnRTY2hlbWE6IHN0cmluZztcblxuICBwcml2YXRlIHNlY29uZHM6IG51bWJlcjtcbiAgcHJpdmF0ZSBtaW51dGVzOiBudW1iZXI7XG4gIHByaXZhdGUgaG91cnM6IG51bWJlcjtcbiAgcHJpdmF0ZSBkYXlzOiBudW1iZXI7XG5cbiAgQElucHV0KCkgc3RhcnRUaW1lOiBudW1iZXI7XG4gIEBJbnB1dCgpIGVuZFRpbWU6IG51bWJlcjtcbiAgQElucHV0KCkgY291bnRkb3duOiBib29sZWFuO1xuICBASW5wdXQoKSBhdXRvU3RhcnQ6IGJvb2xlYW47XG4gIEBJbnB1dCgpIG1heFRpbWVVbml0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIGZvcm1hdDogc3RyaW5nO1xuICBAT3V0cHV0KCkgb25TdGFydDogRXZlbnRFbWl0dGVyPENkVGltZXJDb21wb25lbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxDZFRpbWVyQ29tcG9uZW50PigpO1xuICBAT3V0cHV0KCkgb25TdG9wOiBFdmVudEVtaXR0ZXI8Q2RUaW1lckNvbXBvbmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPENkVGltZXJDb21wb25lbnQ+KCk7XG4gIEBPdXRwdXQoKSBvblRpY2s6IEV2ZW50RW1pdHRlcjxUaW1lSW50ZXJmYWNlPiA9IG5ldyBFdmVudEVtaXR0ZXI8VGltZUludGVyZmFjZT4oKTtcbiAgQE91dHB1dCgpIG9uQ29tcGxldGU6IEV2ZW50RW1pdHRlcjxDZFRpbWVyQ29tcG9uZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8Q2RUaW1lckNvbXBvbmVudD4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsdDogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyKSB7XG4gICAgLy8gSW5pdGlhbGl6YXRpb25cbiAgICB0aGlzLmF1dG9TdGFydCAgPSB0cnVlO1xuICAgIHRoaXMuc3RhcnRUaW1lICA9IDA7XG4gICAgdGhpcy5lbmRUaW1lICAgID0gMDtcbiAgICB0aGlzLnRpbWVvdXRJZCAgPSBudWxsO1xuICAgIHRoaXMuY291bnRkb3duICA9IGZhbHNlO1xuICAgIHRoaXMuZm9ybWF0ICAgICA9ICdkZWZhdWx0JztcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBjb25zdCBuZ0NvbnRlbnROb2RlID0gdGhpcy5lbHQubmF0aXZlRWxlbWVudC5sYXN0Q2hpbGQ7ICAgIC8vIEdldCBsYXN0IGNoaWxkLCBkZWZpbmVkIGJ5IHVzZXIgb3Igc3BhblxuICAgIHRoaXMubmdDb250ZW50U2NoZW1hID0gbmdDb250ZW50Tm9kZSA/IG5nQ29udGVudE5vZGUubm9kZVZhbHVlIDogJyc7XG4gICAgaWYgKHRoaXMuYXV0b1N0YXJ0ID09PSB1bmRlZmluZWQgfHwgdGhpcy5hdXRvU3RhcnQgPT09IHRydWUpIHtcbiAgICAgIHRoaXMuc3RhcnQoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnJlc2V0VGltZW91dCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHRoZSB0aW1lclxuICAgKi9cbiAgcHVibGljIHN0YXJ0KCkge1xuICAgIHRoaXMuaW5pdFZhcigpO1xuICAgIHRoaXMucmVzZXRUaW1lb3V0KCk7XG4gICAgdGhpcy5jb21wdXRlVGltZVVuaXRzKCk7XG4gICAgdGhpcy5zdGFydFRpY2tDb3VudCgpO1xuXG4gICAgdGhpcy5vblN0YXJ0LmVtaXQodGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogUmVzdW1lIHRoZSB0aW1lclxuICAgKi9cbiAgcHVibGljIHJlc3VtZSgpIHtcbiAgICB0aGlzLnJlc2V0VGltZW91dCgpO1xuXG4gICAgdGhpcy5zdGFydFRpY2tDb3VudCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgdGhlIHRpbWVyXG4gICAqL1xuICBwdWJsaWMgc3RvcCgpIHtcbiAgICB0aGlzLmNsZWFyKCk7XG5cbiAgICB0aGlzLm9uU3RvcC5lbWl0KHRoaXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IHRoZSB0aW1lclxuICAgKi9cbiAgcHVibGljIHJlc2V0KCkge1xuICAgIHRoaXMuaW5pdFZhcigpO1xuICAgIHRoaXMucmVzZXRUaW1lb3V0KCk7XG4gICAgdGhpcy5jbGVhcigpO1xuICAgIHRoaXMuY29tcHV0ZVRpbWVVbml0cygpO1xuICAgIHRoaXMucmVuZGVyVGV4dCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgdGltZSBpbmZvcm1hdGlvblxuICAgKiBAcmV0dXJucyBUaW1lSW50ZXJmYWNlXG4gICAqL1xuICBwdWJsaWMgZ2V0KCkge1xuICAgIHJldHVybiB7XG4gICAgICBzZWNvbmRzOiB0aGlzLnNlY29uZHMsXG4gICAgICBtaW51dGVzOiB0aGlzLm1pbnV0ZXMsXG4gICAgICBob3VyczogdGhpcy5ob3VycyxcbiAgICAgIGRheXM6IHRoaXMuZGF5cyxcbiAgICAgIHRpbWVyOiB0aGlzLnRpbWVvdXRJZCxcbiAgICAgIHRpY2tfY291bnQ6IHRoaXMudGlja0NvdW50ZXJcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdmFyaWFibGUgYmVmb3JlIHN0YXJ0XG4gICAqL1xuICBwcml2YXRlIGluaXRWYXIoKSB7XG4gICAgdGhpcy5zdGFydFRpbWUgPSB0aGlzLnN0YXJ0VGltZSB8fCAwO1xuICAgIHRoaXMuZW5kVGltZSAgID0gdGhpcy5lbmRUaW1lIHx8IDA7XG4gICAgdGhpcy5jb3VudGRvd24gPSB0aGlzLmNvdW50ZG93biB8fCBmYWxzZTtcbiAgICB0aGlzLnRpY2tDb3VudGVyID0gdGhpcy5zdGFydFRpbWU7XG5cbiAgICAvLyBEaXNhYmxlIGNvdW50ZG93biBpZiBzdGFydCB0aW1lIG5vdCBkZWZpbmVkXG4gICAgaWYgKHRoaXMuY291bnRkb3duICYmIHRoaXMuc3RhcnRUaW1lID09PSAwKSB7XG4gICAgICB0aGlzLmNvdW50ZG93biA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8vIERldGVybWluZSBhdXRvIGZvcm1hdFxuICAgIGlmICghdGhpcy5mb3JtYXQpIHtcbiAgICAgIHRoaXMuZm9ybWF0ID0gKHRoaXMubmdDb250ZW50U2NoZW1hLmxlbmd0aCA+IDUpID8gJ3VzZXInIDogJ2RlZmF1bHQnO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCB0aW1lb3V0XG4gICAqL1xuICBwcml2YXRlIHJlc2V0VGltZW91dCgpIHtcbiAgICBpZiAodGhpcy50aW1lb3V0SWQpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lb3V0SWQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXIgdGhlIHRpbWUgdG8gRE9NXG4gICAqL1xuICBwcml2YXRlIHJlbmRlclRleHQoKSB7XG4gICAgbGV0IG91dHB1dFRleHQ7XG4gICAgaWYgKHRoaXMuZm9ybWF0ID09PSAndXNlcicpIHtcbiAgICAgIC8vIFVzZXIgcHJlc2VudGF0aW9uXG4gICAgICBjb25zdCBpdGVtcyA9IHtcbiAgICAgICAgJ3NlY29uZHMnOiB0aGlzLnNlY29uZHMsXG4gICAgICAgICdtaW51dGVzJzogdGhpcy5taW51dGVzLFxuICAgICAgICAnaG91cnMnOiB0aGlzLmhvdXJzLFxuICAgICAgICAnZGF5cyc6IHRoaXMuZGF5c1xuICAgICAgfTtcblxuICAgICAgb3V0cHV0VGV4dCA9IHRoaXMubmdDb250ZW50U2NoZW1hO1xuXG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhpdGVtcykpIHtcbiAgICAgICAgb3V0cHV0VGV4dCA9IG91dHB1dFRleHQucmVwbGFjZSgnWycgKyBrZXkgKyAnXScsIChpdGVtcyBhcyBhbnkpW2tleV0udG9TdHJpbmcoKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLmZvcm1hdCA9PT0gJ2ludGVsbGknKSB7XG4gICAgICAvLyBJbnRlbGxpIHByZXNlbnRhdGlvblxuICAgICAgb3V0cHV0VGV4dCA9ICcnO1xuICAgICAgaWYgKHRoaXMuZGF5cyA+IDApIHtcbiAgICAgICAgb3V0cHV0VGV4dCArPSB0aGlzLmRheXMudG9TdHJpbmcoKSArICdkYXknICsgKCh0aGlzLmRheXMgPiAxKSA/ICdzJyA6ICcnKSArICcgJztcbiAgICAgIH1cbiAgICAgIGlmICgodGhpcy5ob3VycyA+IDApIHx8ICh0aGlzLmRheXMgPiAwKSkge1xuICAgICAgICBvdXRwdXRUZXh0ICs9IHRoaXMuaG91cnMudG9TdHJpbmcoKSArICdoICc7XG4gICAgICB9XG4gICAgICBpZiAoKCh0aGlzLm1pbnV0ZXMgPiAwKSB8fCAodGhpcy5ob3VycyA+IDApKSAmJiAodGhpcy5kYXlzID09PSAwKSkge1xuICAgICAgICBvdXRwdXRUZXh0ICs9IHRoaXMubWludXRlcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykgKyAnbWluICc7XG4gICAgICB9XG4gICAgICBpZiAoKHRoaXMuaG91cnMgPT09IDApICYmICh0aGlzLmRheXMgPT09IDApKSB7XG4gICAgICAgIG91dHB1dFRleHQgKz0gdGhpcy5zZWNvbmRzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKSArICdzJztcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMuZm9ybWF0ID09PSAnaG1zJykge1xuICAgICAgLy8gSG1zIHByZXNlbnRhdGlvblxuICAgICAgb3V0cHV0VGV4dCA9IHRoaXMuaG91cnMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpICsgJzonO1xuICAgICAgb3V0cHV0VGV4dCArPSB0aGlzLm1pbnV0ZXMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpICsgJzonO1xuICAgICAgb3V0cHV0VGV4dCArPSB0aGlzLnNlY29uZHMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBEZWZhdWx0IHByZXNlbnRhdGlvblxuICAgICAgb3V0cHV0VGV4dCA9IHRoaXMuZGF5cy50b1N0cmluZygpICsgJ2QgJztcbiAgICAgIG91dHB1dFRleHQgKz0gdGhpcy5ob3Vycy50b1N0cmluZygpICsgJ2ggJztcbiAgICAgIG91dHB1dFRleHQgKz0gdGhpcy5taW51dGVzLnRvU3RyaW5nKCkgKyAnbSAnO1xuICAgICAgb3V0cHV0VGV4dCArPSB0aGlzLnNlY29uZHMudG9TdHJpbmcoKSArICdzJztcbiAgICB9XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMuZWx0Lm5hdGl2ZUVsZW1lbnQsICdpbm5lckhUTUwnLCBvdXRwdXRUZXh0KTtcbiAgfVxuXG4gIHByaXZhdGUgY2xlYXIoKSB7XG4gICAgdGhpcy5yZXNldFRpbWVvdXQoKTtcbiAgICB0aGlzLnRpbWVvdXRJZCA9IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQ29tcHV0ZSBlYWNoIHVuaXQgKHNlY29uZHMsIG1pbnV0ZXMsIGhvdXJzLCBkYXlzKSBmb3IgZnVydGhlciBtYW5pcHVsYXRpb25cbiAgICogQHByb3RlY3RlZFxuICAgKi9cbiAgcHJvdGVjdGVkIGNvbXB1dGVUaW1lVW5pdHMoKSB7XG4gICAgaWYgKCF0aGlzLm1heFRpbWVVbml0IHx8IHRoaXMubWF4VGltZVVuaXQgPT09ICdkYXknKSB7XG4gICAgICB0aGlzLnNlY29uZHMgID0gTWF0aC5mbG9vcih0aGlzLnRpY2tDb3VudGVyICUgNjApO1xuICAgICAgdGhpcy5taW51dGVzICA9IE1hdGguZmxvb3IoKHRoaXMudGlja0NvdW50ZXIgLyA2MCkgJSA2MCk7XG4gICAgICB0aGlzLmhvdXJzICAgID0gTWF0aC5mbG9vcigodGhpcy50aWNrQ291bnRlciAvIDM2MDApICUgMjQpO1xuICAgICAgdGhpcy5kYXlzICAgICA9IE1hdGguZmxvb3IoKHRoaXMudGlja0NvdW50ZXIgLyAzNjAwKSAvIDI0KTtcbiAgICB9IGVsc2UgaWYgKHRoaXMubWF4VGltZVVuaXQgPT09ICdzZWNvbmQnKSB7XG4gICAgICB0aGlzLnNlY29uZHMgID0gdGhpcy50aWNrQ291bnRlcjtcbiAgICAgIHRoaXMubWludXRlcyAgPSAwO1xuICAgICAgdGhpcy5ob3VycyAgICA9IDA7XG4gICAgICB0aGlzLmRheXMgICAgID0gMDtcbiAgICB9IGVsc2UgaWYgKHRoaXMubWF4VGltZVVuaXQgPT09ICdtaW51dGUnKSB7XG4gICAgICB0aGlzLnNlY29uZHMgID0gTWF0aC5mbG9vcih0aGlzLnRpY2tDb3VudGVyICUgNjApO1xuICAgICAgdGhpcy5taW51dGVzICA9IE1hdGguZmxvb3IodGhpcy50aWNrQ291bnRlciAvIDYwKTtcbiAgICAgIHRoaXMuaG91cnMgICAgPSAwO1xuICAgICAgdGhpcy5kYXlzICAgICA9IDA7XG4gICAgfSBlbHNlIGlmICh0aGlzLm1heFRpbWVVbml0ID09PSAnaG91cicpIHtcbiAgICAgIHRoaXMuc2Vjb25kcyAgPSBNYXRoLmZsb29yKHRoaXMudGlja0NvdW50ZXIgJSA2MCk7XG4gICAgICB0aGlzLm1pbnV0ZXMgID0gTWF0aC5mbG9vcigodGhpcy50aWNrQ291bnRlciAvIDYwKSAlIDYwKTtcbiAgICAgIHRoaXMuaG91cnMgICAgPSBNYXRoLmZsb29yKHRoaXMudGlja0NvdW50ZXIgLyAzNjAwKTtcbiAgICAgIHRoaXMuZGF5cyAgICAgPSAwO1xuICAgIH1cblxuICAgIHRoaXMucmVuZGVyVGV4dCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHRpY2sgY291bnQsIGJhc2Ugb2YgdGhpcyBjb21wb25lbnRcbiAgICogQHByb3RlY3RlZFxuICAgKi9cbiAgcHJvdGVjdGVkIHN0YXJ0VGlja0NvdW50ICgpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcblxuICAgIHRoYXQudGltZW91dElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICBsZXQgY291bnRlcjtcblxuICAgICAgaWYgKHRoYXQuY291bnRkb3duKSB7XG4gICAgICAgIC8vIENvbXB1dGUgZmluaXNoIGNvdW50ZXIgZm9yIGNvdW50ZG93blxuICAgICAgICBjb3VudGVyID0gdGhhdC50aWNrQ291bnRlcjtcblxuICAgICAgICBpZiAodGhhdC5zdGFydFRpbWUgPiB0aGF0LmVuZFRpbWUpIHtcbiAgICAgICAgICBjb3VudGVyID0gdGhhdC50aWNrQ291bnRlciAtIHRoYXQuZW5kVGltZSAtIDE7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIENvbXB1dGUgZmluaXNoIGNvdW50ZXIgZm9yIHRpbWVyXG4gICAgICAgIGNvdW50ZXIgPSB0aGF0LnRpY2tDb3VudGVyIC0gdGhhdC5zdGFydFRpbWU7XG5cbiAgICAgICAgaWYgKHRoYXQuZW5kVGltZSA+IHRoYXQuc3RhcnRUaW1lKSB7XG4gICAgICAgICAgY291bnRlciA9IHRoYXQuZW5kVGltZSAtIHRoYXQudGlja0NvdW50ZXIgLSAxO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoYXQuY29tcHV0ZVRpbWVVbml0cygpO1xuXG4gICAgICBjb25zdCB0aW1lcjogVGltZUludGVyZmFjZSA9IHtcbiAgICAgICAgc2Vjb25kczogdGhhdC5zZWNvbmRzLFxuICAgICAgICBtaW51dGVzOiB0aGF0Lm1pbnV0ZXMsXG4gICAgICAgIGhvdXJzOiB0aGF0LmhvdXJzLFxuICAgICAgICBkYXlzOiB0aGF0LmRheXMsXG4gICAgICAgIHRpbWVyOiB0aGF0LnRpbWVvdXRJZCxcbiAgICAgICAgdGlja19jb3VudDogdGhhdC50aWNrQ291bnRlclxuICAgICAgfTtcblxuICAgICAgdGhhdC5vblRpY2suZW1pdCh0aW1lcik7XG5cbiAgICAgIGlmIChjb3VudGVyIDwgMCkge1xuICAgICAgICB0aGF0LnN0b3AoKTtcblxuICAgICAgICB0aGF0Lm9uQ29tcGxldGUuZW1pdCh0aGF0KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhhdC5jb3VudGRvd24pIHtcbiAgICAgICAgdGhhdC50aWNrQ291bnRlci0tO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhhdC50aWNrQ291bnRlcisrO1xuICAgICAgfVxuICAgIH0sIDEwMDApOyAvLyBFYWNoIHNlY29uZHNcbiAgfVxuXG59XG4iXX0=