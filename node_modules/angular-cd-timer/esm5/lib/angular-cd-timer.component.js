var __values = (this && this.__values) || function (o) {
    var m = typeof Symbol === "function" && o[Symbol.iterator], i = 0;
    if (m) return m.call(o);
    return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
};
/**
 * @fileoverview added by tsickle
 * Generated from: lib/angular-cd-timer.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, Input, Output, Renderer2 } from '@angular/core';
var CdTimerComponent = /** @class */ (function () {
    function CdTimerComponent(elt, renderer) {
        this.elt = elt;
        this.renderer = renderer;
        this.onStart = new EventEmitter();
        this.onStop = new EventEmitter();
        this.onTick = new EventEmitter();
        this.onComplete = new EventEmitter();
        // Initialization
        this.autoStart = true;
        this.startTime = 0;
        this.endTime = 0;
        this.timeoutId = null;
        this.countdown = false;
        this.format = 'default';
    }
    /**
     * @return {?}
     */
    CdTimerComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var ngContentNode = this.elt.nativeElement.lastChild;
        this.ngContentSchema = ngContentNode ? ngContentNode.nodeValue : '';
        if (this.autoStart === undefined || this.autoStart === true) {
            this.start();
        }
    };
    /**
     * @return {?}
     */
    CdTimerComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.resetTimeout();
    };
    /**
     * Start the timer
     */
    /**
     * Start the timer
     * @return {?}
     */
    CdTimerComponent.prototype.start = /**
     * Start the timer
     * @return {?}
     */
    function () {
        this.initVar();
        this.resetTimeout();
        this.computeTimeUnits();
        this.startTickCount();
        this.onStart.emit(this);
    };
    /**
     * Resume the timer
     */
    /**
     * Resume the timer
     * @return {?}
     */
    CdTimerComponent.prototype.resume = /**
     * Resume the timer
     * @return {?}
     */
    function () {
        this.resetTimeout();
        this.startTickCount();
    };
    /**
     * Stop the timer
     */
    /**
     * Stop the timer
     * @return {?}
     */
    CdTimerComponent.prototype.stop = /**
     * Stop the timer
     * @return {?}
     */
    function () {
        this.clear();
        this.onStop.emit(this);
    };
    /**
     * Reset the timer
     */
    /**
     * Reset the timer
     * @return {?}
     */
    CdTimerComponent.prototype.reset = /**
     * Reset the timer
     * @return {?}
     */
    function () {
        this.initVar();
        this.resetTimeout();
        this.clear();
        this.computeTimeUnits();
        this.renderText();
    };
    /**
     * Get the time information
     * @returns TimeInterface
     */
    /**
     * Get the time information
     * @return {?} TimeInterface
     */
    CdTimerComponent.prototype.get = /**
     * Get the time information
     * @return {?} TimeInterface
     */
    function () {
        return {
            seconds: this.seconds,
            minutes: this.minutes,
            hours: this.hours,
            days: this.days,
            timer: this.timeoutId,
            tick_count: this.tickCounter
        };
    };
    /**
     * Initialize variable before start
     */
    /**
     * Initialize variable before start
     * @private
     * @return {?}
     */
    CdTimerComponent.prototype.initVar = /**
     * Initialize variable before start
     * @private
     * @return {?}
     */
    function () {
        this.startTime = this.startTime || 0;
        this.endTime = this.endTime || 0;
        this.countdown = this.countdown || false;
        this.tickCounter = this.startTime;
        // Disable countdown if start time not defined
        if (this.countdown && this.startTime === 0) {
            this.countdown = false;
        }
        // Determine auto format
        if (!this.format) {
            this.format = (this.ngContentSchema.length > 5) ? 'user' : 'default';
        }
    };
    /**
     * Reset timeout
     */
    /**
     * Reset timeout
     * @private
     * @return {?}
     */
    CdTimerComponent.prototype.resetTimeout = /**
     * Reset timeout
     * @private
     * @return {?}
     */
    function () {
        if (this.timeoutId) {
            clearInterval(this.timeoutId);
        }
    };
    /**
     * Render the time to DOM
     */
    /**
     * Render the time to DOM
     * @private
     * @return {?}
     */
    CdTimerComponent.prototype.renderText = /**
     * Render the time to DOM
     * @private
     * @return {?}
     */
    function () {
        var e_1, _a;
        /** @type {?} */
        var outputText;
        if (this.format === 'user') {
            // User presentation
            /** @type {?} */
            var items = {
                'seconds': this.seconds,
                'minutes': this.minutes,
                'hours': this.hours,
                'days': this.days
            };
            outputText = this.ngContentSchema;
            try {
                for (var _b = __values(Object.keys(items)), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var key = _c.value;
                    outputText = outputText.replace('[' + key + ']', ((/** @type {?} */ (items)))[key].toString());
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        else if (this.format === 'intelli') {
            // Intelli presentation
            outputText = '';
            if (this.days > 0) {
                outputText += this.days.toString() + 'day' + ((this.days > 1) ? 's' : '') + ' ';
            }
            if ((this.hours > 0) || (this.days > 0)) {
                outputText += this.hours.toString() + 'h ';
            }
            if (((this.minutes > 0) || (this.hours > 0)) && (this.days === 0)) {
                outputText += this.minutes.toString().padStart(2, '0') + 'min ';
            }
            if ((this.hours === 0) && (this.days === 0)) {
                outputText += this.seconds.toString().padStart(2, '0') + 's';
            }
        }
        else if (this.format === 'hms') {
            // Hms presentation
            outputText = this.hours.toString().padStart(2, '0') + ':';
            outputText += this.minutes.toString().padStart(2, '0') + ':';
            outputText += this.seconds.toString().padStart(2, '0');
        }
        else {
            // Default presentation
            outputText = this.days.toString() + 'd ';
            outputText += this.hours.toString() + 'h ';
            outputText += this.minutes.toString() + 'm ';
            outputText += this.seconds.toString() + 's';
        }
        this.renderer.setProperty(this.elt.nativeElement, 'innerHTML', outputText);
    };
    /**
     * @private
     * @return {?}
     */
    CdTimerComponent.prototype.clear = /**
     * @private
     * @return {?}
     */
    function () {
        this.resetTimeout();
        this.timeoutId = null;
    };
    /**
     * Compute each unit (seconds, minutes, hours, days) for further manipulation
     * @protected
     */
    /**
     * Compute each unit (seconds, minutes, hours, days) for further manipulation
     * @protected
     * @return {?}
     */
    CdTimerComponent.prototype.computeTimeUnits = /**
     * Compute each unit (seconds, minutes, hours, days) for further manipulation
     * @protected
     * @return {?}
     */
    function () {
        if (!this.maxTimeUnit || this.maxTimeUnit === 'day') {
            this.seconds = Math.floor(this.tickCounter % 60);
            this.minutes = Math.floor((this.tickCounter / 60) % 60);
            this.hours = Math.floor((this.tickCounter / 3600) % 24);
            this.days = Math.floor((this.tickCounter / 3600) / 24);
        }
        else if (this.maxTimeUnit === 'second') {
            this.seconds = this.tickCounter;
            this.minutes = 0;
            this.hours = 0;
            this.days = 0;
        }
        else if (this.maxTimeUnit === 'minute') {
            this.seconds = Math.floor(this.tickCounter % 60);
            this.minutes = Math.floor(this.tickCounter / 60);
            this.hours = 0;
            this.days = 0;
        }
        else if (this.maxTimeUnit === 'hour') {
            this.seconds = Math.floor(this.tickCounter % 60);
            this.minutes = Math.floor((this.tickCounter / 60) % 60);
            this.hours = Math.floor(this.tickCounter / 3600);
            this.days = 0;
        }
        this.renderText();
    };
    /**
     * Start tick count, base of this component
     * @protected
     */
    /**
     * Start tick count, base of this component
     * @protected
     * @return {?}
     */
    CdTimerComponent.prototype.startTickCount = /**
     * Start tick count, base of this component
     * @protected
     * @return {?}
     */
    function () {
        /** @type {?} */
        var that = this;
        that.timeoutId = setInterval((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var counter;
            if (that.countdown) {
                // Compute finish counter for countdown
                counter = that.tickCounter;
                if (that.startTime > that.endTime) {
                    counter = that.tickCounter - that.endTime - 1;
                }
            }
            else {
                // Compute finish counter for timer
                counter = that.tickCounter - that.startTime;
                if (that.endTime > that.startTime) {
                    counter = that.endTime - that.tickCounter - 1;
                }
            }
            that.computeTimeUnits();
            /** @type {?} */
            var timer = {
                seconds: that.seconds,
                minutes: that.minutes,
                hours: that.hours,
                days: that.days,
                timer: that.timeoutId,
                tick_count: that.tickCounter
            };
            that.onTick.emit(timer);
            if (counter < 0) {
                that.stop();
                that.onComplete.emit(that);
                return;
            }
            if (that.countdown) {
                that.tickCounter--;
            }
            else {
                that.tickCounter++;
            }
        }), 1000); // Each seconds
    };
    CdTimerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'cd-timer',
                    template: ' <ng-content></ng-content>'
                }] }
    ];
    /** @nocollapse */
    CdTimerComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 }
    ]; };
    CdTimerComponent.propDecorators = {
        startTime: [{ type: Input }],
        endTime: [{ type: Input }],
        countdown: [{ type: Input }],
        autoStart: [{ type: Input }],
        maxTimeUnit: [{ type: Input }],
        format: [{ type: Input }],
        onStart: [{ type: Output }],
        onStop: [{ type: Output }],
        onTick: [{ type: Output }],
        onComplete: [{ type: Output }]
    };
    return CdTimerComponent;
}());
export { CdTimerComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.timeoutId;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.tickCounter;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.ngContentSchema;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.seconds;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.minutes;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.hours;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.days;
    /** @type {?} */
    CdTimerComponent.prototype.startTime;
    /** @type {?} */
    CdTimerComponent.prototype.endTime;
    /** @type {?} */
    CdTimerComponent.prototype.countdown;
    /** @type {?} */
    CdTimerComponent.prototype.autoStart;
    /** @type {?} */
    CdTimerComponent.prototype.maxTimeUnit;
    /** @type {?} */
    CdTimerComponent.prototype.format;
    /** @type {?} */
    CdTimerComponent.prototype.onStart;
    /** @type {?} */
    CdTimerComponent.prototype.onStop;
    /** @type {?} */
    CdTimerComponent.prototype.onTick;
    /** @type {?} */
    CdTimerComponent.prototype.onComplete;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.elt;
    /**
     * @type {?}
     * @private
     */
    CdTimerComponent.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1jZC10aW1lci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLWNkLXRpbWVyLyIsInNvdXJjZXMiOlsibGliL2FuZ3VsYXItY2QtdGltZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUNBLE9BQU8sRUFFTCxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQWEsTUFBTSxFQUFFLFNBQVMsRUFDekUsTUFBTSxlQUFlLENBQUM7QUFHdkI7SUF5QkUsMEJBQW9CLEdBQWUsRUFBVSxRQUFtQjtRQUE1QyxRQUFHLEdBQUgsR0FBRyxDQUFZO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUx0RCxZQUFPLEdBQW1DLElBQUksWUFBWSxFQUFvQixDQUFDO1FBQy9FLFdBQU0sR0FBbUMsSUFBSSxZQUFZLEVBQW9CLENBQUM7UUFDOUUsV0FBTSxHQUFnQyxJQUFJLFlBQVksRUFBaUIsQ0FBQztRQUN4RSxlQUFVLEdBQW1DLElBQUksWUFBWSxFQUFvQixDQUFDO1FBRzFGLGlCQUFpQjtRQUNqQixJQUFJLENBQUMsU0FBUyxHQUFJLElBQUksQ0FBQztRQUN2QixJQUFJLENBQUMsU0FBUyxHQUFJLENBQUMsQ0FBQztRQUNwQixJQUFJLENBQUMsT0FBTyxHQUFNLENBQUMsQ0FBQztRQUNwQixJQUFJLENBQUMsU0FBUyxHQUFJLElBQUksQ0FBQztRQUN2QixJQUFJLENBQUMsU0FBUyxHQUFJLEtBQUssQ0FBQztRQUN4QixJQUFJLENBQUMsTUFBTSxHQUFPLFNBQVMsQ0FBQztJQUM5QixDQUFDOzs7O0lBRUQsMENBQWU7OztJQUFmOztZQUNRLGFBQWEsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxTQUFTO1FBQ3RELElBQUksQ0FBQyxlQUFlLEdBQUcsYUFBYSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENB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LENBQUMsU0FBUyxFQUFFO2dCQUNsQixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7YUFDcEI7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO2FBQ3BCO1FBQ0gsQ0FBQyxHQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsZUFBZTtJQUMzQixDQUFDOztnQkE3UUYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxVQUFVO29CQUNwQixRQUFRLEVBQUUsNEJBQTRCO2lCQUN2Qzs7OztnQkFQWSxVQUFVO2dCQUEwQyxTQUFTOzs7NEJBa0J2RSxLQUFLOzBCQUNMLEtBQUs7NEJBQ0wsS0FBSzs0QkFDTCxLQUFLOzhCQUNMLEtBQUs7eUJBQ0wsS0FBSzswQkFDTCxNQUFNO3lCQUNOLE1BQU07eUJBQ04sTUFBTTs2QkFDTixNQUFNOztJQXdQVCx1QkFBQztDQUFBLEFBL1FELElBK1FDO1NBM1FZLGdCQUFnQjs7Ozs7O0lBQzNCLHFDQUF1Qjs7Ozs7SUFDdkIsdUNBQTRCOzs7OztJQUM1QiwyQ0FBZ0M7Ozs7O0lBRWhDLG1DQUF3Qjs7Ozs7SUFDeEIsbUNBQXdCOzs7OztJQUN4QixpQ0FBc0I7Ozs7O0lBQ3RCLGdDQUFxQjs7SUFFckIscUNBQTJCOztJQUMzQixtQ0FBeUI7O0lBQ3pCLHFDQUE0Qjs7SUFDNUIscUNBQTRCOztJQUM1Qix1Q0FBNkI7O0lBQzdCLGtDQUF3Qjs7SUFDeEIsbUNBQXlGOztJQUN6RixrQ0FBd0Y7O0lBQ3hGLGtDQUFrRjs7SUFDbEYsc0NBQTRGOzs7OztJQUVoRiwrQkFBdUI7Ozs7O0lBQUUsb0NBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uRGVzdHJveSwgT3V0cHV0LCBSZW5kZXJlcjJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1RpbWVJbnRlcmZhY2V9IGZyb20gJy4vYW5ndWxhci1jZC10aW1lci5pbnRlcmZhY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjZC10aW1lcicsXG4gIHRlbXBsYXRlOiAnIDxuZy1jb250ZW50PjwvbmctY29udGVudD4nXG59KVxuZXhwb3J0IGNsYXNzIENkVGltZXJDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICBwcml2YXRlIHRpbWVvdXRJZDogYW55O1xuICBwcml2YXRlIHRpY2tDb3VudGVyOiBudW1iZXI7XG4gIHByaXZhdGUgbmdDb250ZW50U2NoZW1hOiBzdHJpbmc7XG5cbiAgcHJpdmF0ZSBzZWNvbmRzOiBudW1iZXI7XG4gIHByaXZhdGUgbWludXRlczogbnVtYmVyO1xuICBwcml2YXRlIGhvdXJzOiBudW1iZXI7XG4gIHByaXZhdGUgZGF5czogbnVtYmVyO1xuXG4gIEBJbnB1dCgpIHN0YXJ0VGltZTogbnVtYmVyO1xuICBASW5wdXQoKSBlbmRUaW1lOiBudW1iZXI7XG4gIEBJbnB1dCgpIGNvdW50ZG93bjogYm9vbGVhbjtcbiAgQElucHV0KCkgYXV0b1N0YXJ0OiBib29sZWFuO1xuICBASW5wdXQoKSBtYXhUaW1lVW5pdDogc3RyaW5nO1xuICBASW5wdXQoKSBmb3JtYXQ6IHN0cmluZztcbiAgQE91dHB1dCgpIG9uU3RhcnQ6IEV2ZW50RW1pdHRlcjxDZFRpbWVyQ29tcG9uZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8Q2RUaW1lckNvbXBvbmVudD4oKTtcbiAgQE91dHB1dCgpIG9uU3RvcDogRXZlbnRFbWl0dGVyPENkVGltZXJDb21wb25lbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxDZFRpbWVyQ29tcG9uZW50PigpO1xuICBAT3V0cHV0KCkgb25UaWNrOiBFdmVudEVtaXR0ZXI8VGltZUludGVyZmFjZT4gPSBuZXcgRXZlbnRFbWl0dGVyPFRpbWVJbnRlcmZhY2U+KCk7XG4gIEBPdXRwdXQoKSBvbkNvbXBsZXRlOiBFdmVudEVtaXR0ZXI8Q2RUaW1lckNvbXBvbmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPENkVGltZXJDb21wb25lbnQ+KCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbHQ6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMikge1xuICAgIC8vIEluaXRpYWxpemF0aW9uXG4gICAgdGhpcy5hdXRvU3RhcnQgID0gdHJ1ZTtcbiAgICB0aGlzLnN0YXJ0VGltZSAgPSAwO1xuICAgIHRoaXMuZW5kVGltZSAgICA9IDA7XG4gICAgdGhpcy50aW1lb3V0SWQgID0gbnVsbDtcbiAgICB0aGlzLmNvdW50ZG93biAgPSBmYWxzZTtcbiAgICB0aGlzLmZvcm1hdCAgICAgPSAnZGVmYXVsdCc7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgY29uc3QgbmdDb250ZW50Tm9kZSA9IHRoaXMuZWx0Lm5hdGl2ZUVsZW1lbnQubGFzdENoaWxkOyAgICAvLyBHZXQgbGFzdCBjaGlsZCwgZGVmaW5lZCBieSB1c2VyIG9yIHNwYW5cbiAgICB0aGlzLm5nQ29udGVudFNjaGVtYSA9IG5nQ29udGVudE5vZGUgPyBuZ0NvbnRlbnROb2RlLm5vZGVWYWx1ZSA6ICcnO1xuICAgIGlmICh0aGlzLmF1dG9TdGFydCA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuYXV0b1N0YXJ0ID09PSB0cnVlKSB7XG4gICAgICB0aGlzLnN0YXJ0KCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5yZXNldFRpbWVvdXQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCB0aGUgdGltZXJcbiAgICovXG4gIHB1YmxpYyBzdGFydCgpIHtcbiAgICB0aGlzLmluaXRWYXIoKTtcbiAgICB0aGlzLnJlc2V0VGltZW91dCgpO1xuICAgIHRoaXMuY29tcHV0ZVRpbWVVbml0cygpO1xuICAgIHRoaXMuc3RhcnRUaWNrQ291bnQoKTtcblxuICAgIHRoaXMub25TdGFydC5lbWl0KHRoaXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3VtZSB0aGUgdGltZXJcbiAgICovXG4gIHB1YmxpYyByZXN1bWUoKSB7XG4gICAgdGhpcy5yZXNldFRpbWVvdXQoKTtcblxuICAgIHRoaXMuc3RhcnRUaWNrQ291bnQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wIHRoZSB0aW1lclxuICAgKi9cbiAgcHVibGljIHN0b3AoKSB7XG4gICAgdGhpcy5jbGVhcigpO1xuXG4gICAgdGhpcy5vblN0b3AuZW1pdCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCB0aGUgdGltZXJcbiAgICovXG4gIHB1YmxpYyByZXNldCgpIHtcbiAgICB0aGlzLmluaXRWYXIoKTtcbiAgICB0aGlzLnJlc2V0VGltZW91dCgpO1xuICAgIHRoaXMuY2xlYXIoKTtcbiAgICB0aGlzLmNvbXB1dGVUaW1lVW5pdHMoKTtcbiAgICB0aGlzLnJlbmRlclRleHQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRpbWUgaW5mb3JtYXRpb25cbiAgICogQHJldHVybnMgVGltZUludGVyZmFjZVxuICAgKi9cbiAgcHVibGljIGdldCgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc2Vjb25kczogdGhpcy5zZWNvbmRzLFxuICAgICAgbWludXRlczogdGhpcy5taW51dGVzLFxuICAgICAgaG91cnM6IHRoaXMuaG91cnMsXG4gICAgICBkYXlzOiB0aGlzLmRheXMsXG4gICAgICB0aW1lcjogdGhpcy50aW1lb3V0SWQsXG4gICAgICB0aWNrX2NvdW50OiB0aGlzLnRpY2tDb3VudGVyXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHZhcmlhYmxlIGJlZm9yZSBzdGFydFxuICAgKi9cbiAgcHJpdmF0ZSBpbml0VmFyKCkge1xuICAgIHRoaXMuc3RhcnRUaW1lID0gdGhpcy5zdGFydFRpbWUgfHwgMDtcbiAgICB0aGlzLmVuZFRpbWUgICA9IHRoaXMuZW5kVGltZSB8fCAwO1xuICAgIHRoaXMuY291bnRkb3duID0gdGhpcy5jb3VudGRvd24gfHwgZmFsc2U7XG4gICAgdGhpcy50aWNrQ291bnRlciA9IHRoaXMuc3RhcnRUaW1lO1xuXG4gICAgLy8gRGlzYWJsZSBjb3VudGRvd24gaWYgc3RhcnQgdGltZSBub3QgZGVmaW5lZFxuICAgIGlmICh0aGlzLmNvdW50ZG93biAmJiB0aGlzLnN0YXJ0VGltZSA9PT0gMCkge1xuICAgICAgdGhpcy5jb3VudGRvd24gPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBEZXRlcm1pbmUgYXV0byBmb3JtYXRcbiAgICBpZiAoIXRoaXMuZm9ybWF0KSB7XG4gICAgICB0aGlzLmZvcm1hdCA9ICh0aGlzLm5nQ29udGVudFNjaGVtYS5sZW5ndGggPiA1KSA/ICd1c2VyJyA6ICdkZWZhdWx0JztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgdGltZW91dFxuICAgKi9cbiAgcHJpdmF0ZSByZXNldFRpbWVvdXQoKSB7XG4gICAgaWYgKHRoaXMudGltZW91dElkKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMudGltZW91dElkKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIHRoZSB0aW1lIHRvIERPTVxuICAgKi9cbiAgcHJpdmF0ZSByZW5kZXJUZXh0KCkge1xuICAgIGxldCBvdXRwdXRUZXh0O1xuICAgIGlmICh0aGlzLmZvcm1hdCA9PT0gJ3VzZXInKSB7XG4gICAgICAvLyBVc2VyIHByZXNlbnRhdGlvblxuICAgICAgY29uc3QgaXRlbXMgPSB7XG4gICAgICAgICdzZWNvbmRzJzogdGhpcy5zZWNvbmRzLFxuICAgICAgICAnbWludXRlcyc6IHRoaXMubWludXRlcyxcbiAgICAgICAgJ2hvdXJzJzogdGhpcy5ob3VycyxcbiAgICAgICAgJ2RheXMnOiB0aGlzLmRheXNcbiAgICAgIH07XG5cbiAgICAgIG91dHB1dFRleHQgPSB0aGlzLm5nQ29udGVudFNjaGVtYTtcblxuICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoaXRlbXMpKSB7XG4gICAgICAgIG91dHB1dFRleHQgPSBvdXRwdXRUZXh0LnJlcGxhY2UoJ1snICsga2V5ICsgJ10nLCAoaXRlbXMgYXMgYW55KVtrZXldLnRvU3RyaW5nKCkpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5mb3JtYXQgPT09ICdpbnRlbGxpJykge1xuICAgICAgLy8gSW50ZWxsaSBwcmVzZW50YXRpb25cbiAgICAgIG91dHB1dFRleHQgPSAnJztcbiAgICAgIGlmICh0aGlzLmRheXMgPiAwKSB7XG4gICAgICAgIG91dHB1dFRleHQgKz0gdGhpcy5kYXlzLnRvU3RyaW5nKCkgKyAnZGF5JyArICgodGhpcy5kYXlzID4gMSkgPyAncycgOiAnJykgKyAnICc7XG4gICAgICB9XG4gICAgICBpZiAoKHRoaXMuaG91cnMgPiAwKSB8fCAodGhpcy5kYXlzID4gMCkpIHtcbiAgICAgICAgb3V0cHV0VGV4dCArPSB0aGlzLmhvdXJzLnRvU3RyaW5nKCkgKyAnaCAnO1xuICAgICAgfVxuICAgICAgaWYgKCgodGhpcy5taW51dGVzID4gMCkgfHwgKHRoaXMuaG91cnMgPiAwKSkgJiYgKHRoaXMuZGF5cyA9PT0gMCkpIHtcbiAgICAgICAgb3V0cHV0VGV4dCArPSB0aGlzLm1pbnV0ZXMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpICsgJ21pbiAnO1xuICAgICAgfVxuICAgICAgaWYgKCh0aGlzLmhvdXJzID09PSAwKSAmJiAodGhpcy5kYXlzID09PSAwKSkge1xuICAgICAgICBvdXRwdXRUZXh0ICs9IHRoaXMuc2Vjb25kcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykgKyAncyc7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLmZvcm1hdCA9PT0gJ2htcycpIHtcbiAgICAgIC8vIEhtcyBwcmVzZW50YXRpb25cbiAgICAgIG91dHB1dFRleHQgPSB0aGlzLmhvdXJzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKSArICc6JztcbiAgICAgIG91dHB1dFRleHQgKz0gdGhpcy5taW51dGVzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKSArICc6JztcbiAgICAgIG91dHB1dFRleHQgKz0gdGhpcy5zZWNvbmRzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRGVmYXVsdCBwcmVzZW50YXRpb25cbiAgICAgIG91dHB1dFRleHQgPSB0aGlzLmRheXMudG9TdHJpbmcoKSArICdkICc7XG4gICAgICBvdXRwdXRUZXh0ICs9IHRoaXMuaG91cnMudG9TdHJpbmcoKSArICdoICc7XG4gICAgICBvdXRwdXRUZXh0ICs9IHRoaXMubWludXRlcy50b1N0cmluZygpICsgJ20gJztcbiAgICAgIG91dHB1dFRleHQgKz0gdGhpcy5zZWNvbmRzLnRvU3RyaW5nKCkgKyAncyc7XG4gICAgfVxuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eSh0aGlzLmVsdC5uYXRpdmVFbGVtZW50LCAnaW5uZXJIVE1MJywgb3V0cHV0VGV4dCk7XG4gIH1cblxuICBwcml2YXRlIGNsZWFyKCkge1xuICAgIHRoaXMucmVzZXRUaW1lb3V0KCk7XG4gICAgdGhpcy50aW1lb3V0SWQgPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXB1dGUgZWFjaCB1bml0IChzZWNvbmRzLCBtaW51dGVzLCBob3VycywgZGF5cykgZm9yIGZ1cnRoZXIgbWFuaXB1bGF0aW9uXG4gICAqIEBwcm90ZWN0ZWRcbiAgICovXG4gIHByb3RlY3RlZCBjb21wdXRlVGltZVVuaXRzKCkge1xuICAgIGlmICghdGhpcy5tYXhUaW1lVW5pdCB8fCB0aGlzLm1heFRpbWVVbml0ID09PSAnZGF5Jykge1xuICAgICAgdGhpcy5zZWNvbmRzICA9IE1hdGguZmxvb3IodGhpcy50aWNrQ291bnRlciAlIDYwKTtcbiAgICAgIHRoaXMubWludXRlcyAgPSBNYXRoLmZsb29yKCh0aGlzLnRpY2tDb3VudGVyIC8gNjApICUgNjApO1xuICAgICAgdGhpcy5ob3VycyAgICA9IE1hdGguZmxvb3IoKHRoaXMudGlja0NvdW50ZXIgLyAzNjAwKSAlIDI0KTtcbiAgICAgIHRoaXMuZGF5cyAgICAgPSBNYXRoLmZsb29yKCh0aGlzLnRpY2tDb3VudGVyIC8gMzYwMCkgLyAyNCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLm1heFRpbWVVbml0ID09PSAnc2Vjb25kJykge1xuICAgICAgdGhpcy5zZWNvbmRzICA9IHRoaXMudGlja0NvdW50ZXI7XG4gICAgICB0aGlzLm1pbnV0ZXMgID0gMDtcbiAgICAgIHRoaXMuaG91cnMgICAgPSAwO1xuICAgICAgdGhpcy5kYXlzICAgICA9IDA7XG4gICAgfSBlbHNlIGlmICh0aGlzLm1heFRpbWVVbml0ID09PSAnbWludXRlJykge1xuICAgICAgdGhpcy5zZWNvbmRzICA9IE1hdGguZmxvb3IodGhpcy50aWNrQ291bnRlciAlIDYwKTtcbiAgICAgIHRoaXMubWludXRlcyAgPSBNYXRoLmZsb29yKHRoaXMudGlja0NvdW50ZXIgLyA2MCk7XG4gICAgICB0aGlzLmhvdXJzICAgID0gMDtcbiAgICAgIHRoaXMuZGF5cyAgICAgPSAwO1xuICAgIH0gZWxzZSBpZiAodGhpcy5tYXhUaW1lVW5pdCA9PT0gJ2hvdXInKSB7XG4gICAgICB0aGlzLnNlY29uZHMgID0gTWF0aC5mbG9vcih0aGlzLnRpY2tDb3VudGVyICUgNjApO1xuICAgICAgdGhpcy5taW51dGVzICA9IE1hdGguZmxvb3IoKHRoaXMudGlja0NvdW50ZXIgLyA2MCkgJSA2MCk7XG4gICAgICB0aGlzLmhvdXJzICAgID0gTWF0aC5mbG9vcih0aGlzLnRpY2tDb3VudGVyIC8gMzYwMCk7XG4gICAgICB0aGlzLmRheXMgICAgID0gMDtcbiAgICB9XG5cbiAgICB0aGlzLnJlbmRlclRleHQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCB0aWNrIGNvdW50LCBiYXNlIG9mIHRoaXMgY29tcG9uZW50XG4gICAqIEBwcm90ZWN0ZWRcbiAgICovXG4gIHByb3RlY3RlZCBzdGFydFRpY2tDb3VudCAoKSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG5cbiAgICB0aGF0LnRpbWVvdXRJZCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgICAgbGV0IGNvdW50ZXI7XG5cbiAgICAgIGlmICh0aGF0LmNvdW50ZG93bikge1xuICAgICAgICAvLyBDb21wdXRlIGZpbmlzaCBjb3VudGVyIGZvciBjb3VudGRvd25cbiAgICAgICAgY291bnRlciA9IHRoYXQudGlja0NvdW50ZXI7XG5cbiAgICAgICAgaWYgKHRoYXQuc3RhcnRUaW1lID4gdGhhdC5lbmRUaW1lKSB7XG4gICAgICAgICAgY291bnRlciA9IHRoYXQudGlja0NvdW50ZXIgLSB0aGF0LmVuZFRpbWUgLSAxO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBDb21wdXRlIGZpbmlzaCBjb3VudGVyIGZvciB0aW1lclxuICAgICAgICBjb3VudGVyID0gdGhhdC50aWNrQ291bnRlciAtIHRoYXQuc3RhcnRUaW1lO1xuXG4gICAgICAgIGlmICh0aGF0LmVuZFRpbWUgPiB0aGF0LnN0YXJ0VGltZSkge1xuICAgICAgICAgIGNvdW50ZXIgPSB0aGF0LmVuZFRpbWUgLSB0aGF0LnRpY2tDb3VudGVyIC0gMTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGF0LmNvbXB1dGVUaW1lVW5pdHMoKTtcblxuICAgICAgY29uc3QgdGltZXI6IFRpbWVJbnRlcmZhY2UgPSB7XG4gICAgICAgIHNlY29uZHM6IHRoYXQuc2Vjb25kcyxcbiAgICAgICAgbWludXRlczogdGhhdC5taW51dGVzLFxuICAgICAgICBob3VyczogdGhhdC5ob3VycyxcbiAgICAgICAgZGF5czogdGhhdC5kYXlzLFxuICAgICAgICB0aW1lcjogdGhhdC50aW1lb3V0SWQsXG4gICAgICAgIHRpY2tfY291bnQ6IHRoYXQudGlja0NvdW50ZXJcbiAgICAgIH07XG5cbiAgICAgIHRoYXQub25UaWNrLmVtaXQodGltZXIpO1xuXG4gICAgICBpZiAoY291bnRlciA8IDApIHtcbiAgICAgICAgdGhhdC5zdG9wKCk7XG5cbiAgICAgICAgdGhhdC5vbkNvbXBsZXRlLmVtaXQodGhhdCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoYXQuY291bnRkb3duKSB7XG4gICAgICAgIHRoYXQudGlja0NvdW50ZXItLTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoYXQudGlja0NvdW50ZXIrKztcbiAgICAgIH1cbiAgICB9LCAxMDAwKTsgLy8gRWFjaCBzZWNvbmRzXG4gIH1cblxufVxuIl19