!function(){function e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,i)}function a(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function s(e){i(o,n,a,s,u,"next",e)}function u(e){i(o,n,a,s,u,"throw",e)}s(void 0)})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=p(e);if(t){var i=p(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}function f(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(self.webpackChunkonTarget=self.webpackChunkonTarget||[]).push([[7328],{37328:function(r,n,i){"use strict";function f(e){var t=e.split("/").filter(function(e){return"."!==e}),r=[];return t.forEach(function(e){".."===e&&r.length>0&&".."!==r[r.length-1]?r.pop():r.push(e)}),r.join("/")}i.r(n),i.d(n,{FilesystemWeb:function(){return p}});var p=function(r){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(j,r);var n,i,p,h,d,l,y,b,v,m,x,g,w,k,R,P,E,O,S,q,_,F=c(j);function j(){var e;return o(this,j),(e=F.apply(this,arguments)).DB_VERSION=1,e.DB_NAME="Disc",e._writeCmds=["add","put","delete"],e}return n=j,i=[{key:"initDb",value:(_=a(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this._db){e.next=2;break}return e.abrupt("return",this._db);case 2:if("indexedDB"in window){e.next=4;break}throw this.unavailable("This browser doesn't support IndexedDB");case 4:return e.abrupt("return",new Promise(function(e,r){var n=indexedDB.open(t.DB_NAME,t.DB_VERSION);n.onupgradeneeded=j.doUpgrade,n.onsuccess=function(){t._db=n.result,e(n.result)},n.onerror=function(){return r(n.error)},n.onblocked=function(){console.warn("db blocked")}}));case 5:case"end":return e.stop()}},e,this)})),function(){return _.apply(this,arguments)})},{key:"dbRequest",value:(q=a(regeneratorRuntime.mark(function e(r,n){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=-1!==this._writeCmds.indexOf(r)?"readwrite":"readonly",e.abrupt("return",this.initDb().then(function(e){return new Promise(function(a,o){var s,u=(s=e.transaction(["FileStorage"],i).objectStore("FileStorage"))[r].apply(s,t(n));u.onsuccess=function(){return a(u.result)},u.onerror=function(){return o(u.error)}})}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return q.apply(this,arguments)})},{key:"dbIndexRequest",value:(S=a(regeneratorRuntime.mark(function e(r,n,i){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=-1!==this._writeCmds.indexOf(n)?"readwrite":"readonly",e.abrupt("return",this.initDb().then(function(e){return new Promise(function(o,s){var u,c=(u=e.transaction(["FileStorage"],a).objectStore("FileStorage").index(r))[n].apply(u,t(i));c.onsuccess=function(){return o(c.result)},c.onerror=function(){return s(c.error)}})}));case 2:case"end":return e.stop()}},e,this)})),function(e,t,r){return S.apply(this,arguments)})},{key:"getPath",value:function(e,t){var r=void 0!==t?t.replace(/^[/]+|[/]+$/g,""):"",n="";return void 0!==e&&(n+="/"+e),""!==t&&(n+="/"+r),n}},{key:"clear",value:(O=a(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initDb();case 2:e.sent.transaction(["FileStorage"],"readwrite").objectStore("FileStorage").clear();case 3:case"end":return e.stop()}},e,this)})),function(){return O.apply(this,arguments)})},{key:"readFile",value:(E=a(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getPath(t.directory,t.path),e.next=3,this.dbRequest("get",[r]);case 3:if(void 0!==(n=e.sent)){e.next=6;break}throw Error("File does not exist.");case 6:return e.abrupt("return",{data:n.content?n.content:""});case 7:case"end":return e.stop()}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"writeFile",value:(P=a(regeneratorRuntime.mark(function e(t){var r,n,i,a,o,s,u,c,f,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getPath(t.directory,t.path),n=t.data,i=t.recursive,e.next=5,this.dbRequest("get",[r]);case 5:if(!(a=e.sent)||"directory"!==a.type){e.next=8;break}throw Error("The supplied path is a directory.");case 8:return o=t.encoding,s=r.substr(0,r.lastIndexOf("/")),e.t0=void 0,e.next=12,this.dbRequest("get",[s]);case 12:if(e.t1=e.sent,e.t0!==e.t1){e.next=19;break}if(-1===(u=s.indexOf("/",1))){e.next=19;break}return c=s.substr(u),e.next=19,this.mkdir({path:c,directory:t.directory,recursive:i});case 19:return f=Date.now(),p={path:r,folder:s,type:"file",size:n.length,ctime:f,mtime:f,content:!o&&n.indexOf(",")>=0?n.split(",")[1]:n},e.next=22,this.dbRequest("put",[p]);case 22:return e.abrupt("return",{uri:p.path});case 23:case"end":return e.stop()}},e,this)})),function(e){return P.apply(this,arguments)})},{key:"appendFile",value:(R=a(regeneratorRuntime.mark(function e(t){var r,n,i,a,o,s,u,c,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getPath(t.directory,t.path),n=t.data,i=r.substr(0,r.lastIndexOf("/")),a=Date.now(),o=a,e.next=6,this.dbRequest("get",[r]);case 6:if(!(s=e.sent)||"directory"!==s.type){e.next=9;break}throw Error("The supplied path is a directory.");case 9:return e.t0=void 0,e.next=12,this.dbRequest("get",[i]);case 12:if(e.t1=e.sent,e.t0!==e.t1){e.next=19;break}if(-1===(u=i.indexOf("/",1))){e.next=19;break}return c=i.substr(u),e.next=19,this.mkdir({path:c,directory:t.directory,recursive:!0});case 19:return void 0!==s&&(n=s.content+n,o=s.ctime),f={path:r,folder:i,type:"file",size:n.length,ctime:o,mtime:a,content:n},e.next=23,this.dbRequest("put",[f]);case 23:case"end":return e.stop()}},e,this)})),function(e){return R.apply(this,arguments)})},{key:"deleteFile",value:(k=a(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getPath(t.directory,t.path),e.t0=void 0,e.next=4,this.dbRequest("get",[r]);case 4:if(e.t1=e.sent,e.t0!==e.t1){e.next=7;break}throw Error("File does not exist.");case 7:return e.next=9,this.dbIndexRequest("by_folder","getAllKeys",[IDBKeyRange.only(r)]);case 9:if(e.t2=e.sent.length,0===e.t2){e.next=12;break}throw Error("Folder is not empty.");case 12:return e.next=14,this.dbRequest("delete",[r]);case 14:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"mkdir",value:(w=a(regeneratorRuntime.mark(function e(t){var r,n,i,a,o,s,u,c,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getPath(t.directory,t.path),n=t.recursive,i=r.substr(0,r.lastIndexOf("/")),a=(r.match(/\//g)||[]).length,e.next=6,this.dbRequest("get",[i]);case 6:return o=e.sent,e.next=9,this.dbRequest("get",[r]);case 9:if(s=e.sent,1!==a){e.next=12;break}throw Error("Cannot create Root directory");case 12:if(void 0===s){e.next=14;break}throw Error("Current directory does already exist.");case 14:if(n||2===a||void 0!==o){e.next=16;break}throw Error("Parent directory must exist");case 16:if(!n||2===a||void 0!==o){e.next=20;break}return u=i.substr(i.indexOf("/",1)),e.next=20,this.mkdir({path:u,directory:t.directory,recursive:n});case 20:return c=Date.now(),f={path:r,folder:i,type:"directory",size:0,ctime:c,mtime:c},e.next=23,this.dbRequest("put",[f]);case 23:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"rmdir",value:(g=a(regeneratorRuntime.mark(function t(r){var n,i,a,o,s,u,c,f,p,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.path,i=r.directory,a=r.recursive,o=this.getPath(i,n),t.next=6,this.dbRequest("get",[o]);case 6:if(void 0!==(s=t.sent)){t.next=9;break}throw Error("Folder does not exist.");case 9:if("directory"===s.type){t.next=11;break}throw Error("Requested path is not a directory");case 11:return t.next=13,this.readdir({path:n,directory:i});case 13:if(0===(u=t.sent).files.length||a){t.next=16;break}throw Error("Folder is not empty");case 16:c=e(u.files),t.prev=17,c.s();case 19:if((f=c.n()).done){t.next=34;break}return p=f.value,h="".concat(n,"/").concat(p),t.next=24,this.stat({path:h,directory:i});case 24:if(t.t0=t.sent.type,"file"!==t.t0){t.next=30;break}return t.next=28,this.deleteFile({path:h,directory:i});case 28:t.next=32;break;case 30:return t.next=32,this.rmdir({path:h,directory:i,recursive:a});case 32:t.next=19;break;case 34:t.next=39;break;case 36:t.prev=36,t.t1=t.catch(17),c.e(t.t1);case 39:return t.prev=39,c.f(),t.finish(39);case 42:return t.next=44,this.dbRequest("delete",[o]);case 44:case"end":return t.stop()}},t,this,[[17,36,39,42]])})),function(e){return g.apply(this,arguments)})},{key:"readdir",value:(x=a(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getPath(t.directory,t.path),e.next=3,this.dbRequest("get",[r]);case 3:if(n=e.sent,""===t.path||void 0!==n){e.next=6;break}throw Error("Folder does not exist.");case 6:return e.next=8,this.dbIndexRequest("by_folder","getAllKeys",[IDBKeyRange.only(r)]);case 8:return e.t0=e.sent.map(function(e){return e.substring(r.length+1)}),e.abrupt("return",{files:e.t0});case 10:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"getUri",value:(m=a(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getPath(t.directory,t.path),e.next=3,this.dbRequest("get",[r]);case 3:if(n=e.sent,e.t0=void 0===n,!e.t0){e.next=9;break}return e.next=8,this.dbRequest("get",[r+"/"]);case 8:n=e.sent;case 9:return e.abrupt("return",{uri:(null==n?void 0:n.path)||r});case 10:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"stat",value:(v=a(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getPath(t.directory,t.path),e.next=3,this.dbRequest("get",[r]);case 3:if(n=e.sent,e.t0=void 0===n,!e.t0){e.next=9;break}return e.next=8,this.dbRequest("get",[r+"/"]);case 8:n=e.sent;case 9:if(void 0!==n){e.next=11;break}throw Error("Entry does not exist.");case 11:return e.abrupt("return",{type:n.type,size:n.size,ctime:n.ctime,mtime:n.mtime,uri:n.path});case 12:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"rename",value:(b=a(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._copy(t,!0));case 1:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"copy",value:(y=a(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._copy(t,!1));case 1:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"requestPermissions",value:(l=a(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{publicStorage:"granted"});case 1:case"end":return e.stop()}},e)})),function(){return l.apply(this,arguments)})},{key:"checkPermissions",value:(d=a(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{publicStorage:"granted"});case 1:case"end":return e.stop()}},e)})),function(){return d.apply(this,arguments)})},{key:"_copy",value:(h=a(regeneratorRuntime.mark(function t(r){var n,i,o,s,u,c,p,h,d,l,y,b,v,m,x,g,w,k,R=this,P=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=P.length>1&&void 0!==P[1]&&P[1],i=r.toDirectory,o=r.to,s=r.from,u=r.directory,o&&s){t.next=5;break}throw Error("Both to and from must be provided");case 5:if(i||(i=u),c=this.getPath(u,s),p=this.getPath(i,o),c!==p){t.next=9;break}return t.abrupt("return");case 9:if(!function(e,t){e=f(e),t=f(t);var r=e.split("/"),n=t.split("/");return e!==t&&r.every(function(e,t){return e===n[t]})}(c,p)){t.next=11;break}throw Error("To path cannot contain the from path");case 11:return t.prev=11,t.next=14,this.stat({path:o,directory:i});case 14:h=t.sent,t.next=30;break;case 17:if(t.prev=17,t.t0=t.catch(11),(d=o.split("/")).pop(),l=d.join("/"),t.t1=d.length>0,!t.t1){t.next=28;break}return t.next=26,this.stat({path:l,directory:i});case 26:t.t2=t.sent.type,t.t1="directory"!==t.t2;case 28:if(!t.t1){t.next=30;break}throw new Error("Parent directory of the to path is a file");case 30:if(!h||"directory"!==h.type){t.next=32;break}throw new Error("Cannot overwrite a directory with a file");case 32:return t.next=34,this.stat({path:s,directory:u});case 34:y=t.sent,b=function(){var e=a(regeneratorRuntime.mark(function e(t,r,n){var a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=R.getPath(i,t),e.next=3,R.dbRequest("get",[a]);case 3:return(o=e.sent).ctime=r,o.mtime=n,e.next=8,R.dbRequest("put",[o]);case 8:case"end":return e.stop()}},e)}));return function(t,r,n){return e.apply(this,arguments)}}(),v=y.ctime?y.ctime:Date.now(),t.t3=y.type,t.next="file"===t.t3?40:"directory"===t.t3?55:92;break;case 40:return t.next=42,this.readFile({path:s,directory:u});case 42:if(m=t.sent,t.t4=n,!t.t4){t.next=47;break}return t.next=47,this.deleteFile({path:s,directory:u});case 47:return t.next=49,this.writeFile({path:o,directory:i,data:m.data});case 49:if(t.t5=n,!t.t5){t.next=54;break}return t.next=53,b(o,v,y.mtime);case 53:t.t5=t.sent;case 54:return t.abrupt("return",void t.t5);case 55:if(!h){t.next=57;break}throw Error("Cannot move a directory over an existing object");case 57:return t.prev=57,t.next=60,this.mkdir({path:o,directory:i,recursive:!1});case 60:if(t.t6=n,!t.t6){t.next=64;break}return t.next=64,b(o,v,y.mtime);case 64:t.next=68;break;case 66:t.prev=66,t.t7=t.catch(57);case 68:return t.next=70,this.readdir({path:s,directory:u});case 70:x=t.sent.files,g=e(x),t.prev=72,g.s();case 74:if((w=g.n()).done){t.next=80;break}return k=w.value,t.next=78,this._copy({from:"".concat(s,"/").concat(k),to:"".concat(o,"/").concat(k),directory:u,toDirectory:i},n);case 78:t.next=74;break;case 80:t.next=85;break;case 82:t.prev=82,t.t8=t.catch(72),g.e(t.t8);case 85:return t.prev=85,g.f(),t.finish(85);case 88:if(t.t9=n,!t.t9){t.next=92;break}return t.next=92,this.rmdir({path:s,directory:u});case 92:case"end":return t.stop()}},t,this,[[11,17],[57,66],[72,82,85,88]])})),function(e){return h.apply(this,arguments)})}],p=[{key:"doUpgrade",value:function(e){var t=e.target.result;switch(e.oldVersion){case 0:case 1:default:t.objectStoreNames.contains("FileStorage")&&t.deleteObjectStore("FileStorage"),t.createObjectStore("FileStorage",{keyPath:"path"}).createIndex("by_folder","folder")}}}],i&&s(n.prototype,i),p&&s(n,p),Object.defineProperty(n,"prototype",{writable:!1}),j}(i(15310).Uw);p._debug=!0}}])}();